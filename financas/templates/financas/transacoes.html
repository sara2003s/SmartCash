{% extends "financas/base.html" %}
{% load static %}
{% load humanize %}

{% block title %}Transações{% endblock %}

{% block content %}
<div class="p-1">
    <h1 class="text-2xl font-bold">Transações</h1>
    <p class="text-gray-500 mb-6">Acompanhe todas as suas movimentações financeiras</p>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
        <div class="bg-white p-4 rounded-lg shadow flex items-center justify-between">
            <div>
                <p class="text-sm text-gray-600">Receitas</p>
                <p class="text-2xl font-bold text-green-600">R$ {{ total_receitas|floatformat:2|intcomma }}</p>
            </div>
            <img src="{% static 'img/trending-up (1).png' %}" alt="trending-up" class="w-8 h-8">
        </div>
        
        <div class="bg-white p-4 rounded-lg shadow flex items-center justify-between">
            <div>
                <p class="text-sm text-gray-600">Despesas</p>
                <p class="text-2xl font-bold text-red-600">R$ {{ total_despesas|floatformat:2|intcomma }}</p>
            </div>
            <img src="{% static 'img/trending-down.png' %}" alt="trending-down" class="w-8 h-8">
        </div>
        
        <div class="bg-white p-4 rounded-lg shadow flex items-center justify-between">
            <div>
                <p class="text-sm text-gray-600">Saldo</p>
                <p class="text-2xl font-bold {% if saldo >= 0 %}text-green-600{% else %}text-red-600{% endif %}">R$ {{ saldo|floatformat:2|intcomma }}</p>
            </div>
            <img src="{% static 'img/dollar-sign.png' %}" alt="dollar-sign" class="w-8 h-8">
        </div>
    </div>

    <div class="bg-white p-4 rounded-lg shadow mb-8">
        <h2 class="font-bold text-lg mb-4">Filtros</h2>
        <form method="GET" class="grid grid-cols-1 md:grid-cols-4 gap-4">

            <div>
                <label class="block text-sm text-gray-600">Período</label>
                <select name="periodo" class="border rounded px-2 py-1 w-full">
                    <option value="">Todos os períodos</option>
                    {% for periodo in periodos %}
                        <option value="{{ periodo }}" {% if request.GET.periodo == periodo %}selected{% endif %}>
                            {{ periodo }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div>
                <label class="block text-sm text-gray-600">Buscar</label>
                <input type="text" name="q" value="{{ request.GET.q|default:"" }}" placeholder="Buscar transações..." class="w-full border rounded px-2 py-1">
            </div>

            <div>
                <label class="block text-sm text-gray-600">Categoria</label>
                <select name="categoria" class="w-full border rounded px-2 py-1">
                    <option value="">Todas as categorias</option>
                    {% for cat in categorias %}
                        <option value="{{ cat.id }}" {% if request.GET.categoria == cat.id|stringformat:"s" %}selected{% endif %}>
                            {{ cat.nome }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div>
                <label class="block text-sm text-gray-600">Tipo</label>
                <select name="tipo" class="w-full border rounded px-2 py-1">
                    <option value="">Todos</option>
                    <option value="entrada" {% if request.GET.tipo == "entrada" %}selected{% endif %}>Receita</option>
                    <option value="saida" {% if request.GET.tipo == "saida" %}selected{% endif %}>Despesa</option>
                </select>
            </div>

            <div class="col-span-1 md:col-span-4 flex justify-end">
                <button type="submit" class="px-4 py-2 bg-[#262d3f] text-white rounded-lg">
                    Aplicar filtros
                </button>
            </div>
        </form>
    </div>

    <div class="bg-white p-4 rounded-lg shadow">
        <h2 class="font-bold text-lg mb-1">Histórico de Transações</h2>
        <p class="text-gray-500 text-sm mb-2">{{ transacoes|length }} transação(ões) encontrada(s)</p>

        <table class="w-full border-collapse">
            <thead>
                <tr class="border-b text-[#64748b]">
                    <th class="text-left font-medium py-2 px-3">Data</th>
                    <th class="text-left font-medium py-2 px-3">Descrição</th>
                    <th class="text-left font-medium py-2 px-3">Categoria</th>
                    <th class="text-left font-medium py-2 px-3">Tipo</th>
                    <th class="text-left font-medium py-2 px-3">Valor</th>
                </tr>
            </thead>
            <tbody>
                {% for t in transacoes %}
                <tr class="border-b">
                    <td class="py-2 px-3">{{ t.data|date:"d/m/Y" }}</td>
                    <td class="py-2 px-3">{{ t.nome }}</td>
                    <td class="py-2 px-3">{{ t.categoria.nome }}</td>
                    <td class="py-2 px-3">
                        {% if t.tipo == 'entrada' %}
                            <span class="text-green-600 font-semibold">Receita</span>
                        {% else %}
                            <span class="text-red-600 font-semibold">Despesa</span>
                        {% endif %}
                    </td>
                    <td class="py-2 px-3 font-bold {% if t.tipo == 'entrada' %}text-green-600{% else %}text-red-600{% endif %}">
                        {% if t.tipo == 'entrada' %}+{% else %}-{% endif %}
                        R$ {{ t.valor|floatformat:2|intcomma }}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="text-center text-gray-500 py-4">
                        Nenhuma transação encontrada
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}